<!DOCTYPE html>
<html>
<body onload="paises()">
<h2>Alta Cliente</h2>
<div>
    <label>Nombre:</label>
    <input type="text" id="last_name"/><br><br>
    <label>Apellido:</label>
    <input type="text" id="first_name"/><br><br>
    <label>Email:</label>
    <input type="email" id="email" /><br><br>
    <label>Dirección:</label>
    <input type="text" id="address" /><br><br>
    <label>Dirección Alternativa:</label>
    <input type="text" id="address2" /><br><br> 
    <label>Distrito:</label>
    <input type="text" id="district" /><br><br>  
    <label>Pais:</label>
    <select id="paises"  onchange="ciudades()"></select><br><br>              
    <label>Ciudad:</label>
    <select id="ciudades"></select><br><br>        
    <label>Codigo Postal:</label>
    <input type="text" id="postal_code" /><br><br>    
    <label>Telefono:</label>
    <input type="text" id="phone" /><br><br>    
    <label>Latitud y Longitud: <input type="text" id="location" /> <input type="button" onclick="getLocation()" value="consultar"/></label>
    <br><br>        
    <label>Activo:</label>
    <label for="si">Si</label>
    <input type="radio" id="active" name="Si" value="1"/>
    <label for="no">No</label>
    <input type="radio" id="active" name="No" value="0"/><br><br>    

</div>


    <br><br>
    <input type="button" onclick="alta()" value="Enviar"/>
    <div id="mensaje"></div>
</body>
<script>
    function paises() {
        var out = "";
        var xhttp = new XMLHttpRequest();
        xhttp.open("GET", "/paises", false);
        xhttp.setRequestHeader("Content-Type", "application/json");
        xhttp.send();        
        var data = JSON.parse(xhttp.responseText)
        for (let i = 0; i < data.length; i++) {
            out += '<option value="' + data[i].country_id + '">' + data[i].country + '</option>';
            }        
        document.getElementById('paises').innerHTML=out;
    }

    function ciudades() {
        var out = "";
        var xhttp = new XMLHttpRequest();
        xhttp.open("POST", "/ciudades", false);
        xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhttp.send(JSON.stringify({"country_id":document.getElementById('paises').value}));         
        var data = JSON.parse(xhttp.responseText)
        for (let i = 0; i < data.length; i++) {
            out += '<option value="' + data[i].city_id + '">' + data[i].city + '</option>';
            }        
        document.getElementById('ciudades').innerHTML=out;
    }
    function alta() {
        var xhttp = new XMLHttpRequest();
        xhttp.open("GET", "/alta", false);
        xhttp.send();
        var ele = document.getElementById("location").innerHTML=xhttp.responseText;
    }

    function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
    } else { 
        document.getElementById("location").innerHTML = "Geolocation is not supported by this browser.";
    }
    }

    function showPosition(position) {
    document.getElementById("location").value = "POINT(" + position.coords.latitude + 
    "," + position.coords.longitude+")";
    }
</script>    
</html>